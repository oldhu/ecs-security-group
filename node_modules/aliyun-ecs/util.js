var crypto = require('crypto');

//签名编码
function percentEncode(str) {
    var res = encodeURIComponent(str);
    res = res.replace(/\+/g, '%20');
    res = res.replace(/\*/g, '%2A');
    res = res.replace(/%7E/g, '~');
    return res;
}

module.exports = {
    //签名
    getSignature: function (params, secret) {
        var keys = Object.keys(params).sort();
        var _keys = [];
        for (var i = 0, len = keys.length; i < len; i++) {
            _keys.push(percentEncode(keys[i]) + '=' + percentEncode(params[keys[i]]));
        }
        var queryString = _keys.join('&');
        var stringToSign = 'GET&%2F&' + percentEncode(queryString);
        var hmac = crypto.createHmac('sha1', secret + '&');
        hmac.update(stringToSign);
        return hmac.digest('base64');
    },
    // 是否是函数
    isFunction: function (obj) {
        return !!(obj && obj.constructor && obj.call && obj.apply);
    }

}